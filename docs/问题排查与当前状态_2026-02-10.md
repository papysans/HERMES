# Hermes é—®é¢˜æ’æŸ¥ä¸å½“å‰çŠ¶æ€

> ğŸ“… åˆ›å»ºæ—¥æœŸ: 2026-02-10
> ğŸ“Œ ç‰ˆæœ¬: V1.1
> ğŸ¯ ç›®æ ‡: è®°å½•æ‰€æœ‰å·²å‘ç°çš„é—®é¢˜ã€æ ¹å› åˆ†æå’Œä¿®å¤çŠ¶æ€

---

## å·²è§£å†³çš„é—®é¢˜

### P1: HERMES_HOOK_TOKEN æœªè®¾ç½®

**æ ¹å› **: ç¯å¢ƒå˜é‡æœªåœ¨ `.zshrc` ä¸­æŒä¹…åŒ–ï¼Œæˆ– OpenCode å¯åŠ¨æ—¶æœª `source ~/.zshrc`ã€‚
**ä¿®å¤**: å·²æ·»åŠ åˆ° `~/.zshrc`ã€‚å¯åŠ¨ OpenCode å‰å¿…é¡» `source ~/.zshrc`ã€‚
**çŠ¶æ€**: âœ… å·²è§£å†³

### P2: åŒæ­¥ API é˜»å¡

**æ ¹å› **: OpenClaw agent ä½¿ç”¨ `POST /session/{id}/message`ï¼ˆåŒæ­¥ï¼‰ï¼Œè§¦å‘ permission æ—¶æ°¸è¿œæŒ‚èµ·ã€‚
**ä¿®å¤**: SOUL.md å’Œ TOOLS.md æ”¹ç”¨ `prompt_async`ã€‚
**çŠ¶æ€**: âœ… å·²è§£å†³

### P3: deliver æ¨¡å¼ä¸å·¥ä½œ

**æ ¹å› **: `deliver: true` éœ€è¦ prior delivery routeï¼Œæ²¡æœ‰æ—¶é™é»˜å¤±è´¥ã€‚
**ä¿®å¤**: ç»Ÿä¸€ä½¿ç”¨ `wakeMode: "now"` + `channel` + `to`ã€‚
**çŠ¶æ€**: âœ… å·²è§£å†³

### P4: æ¶ˆæ¯è·¯ç”±åˆ°ä¸» BOT DM

**æ ¹å› **: ä¸æŒ‡å®š `channel`/`to` æ—¶èµ°é»˜è®¤ delivery routeï¼ˆDMï¼‰ã€‚
**ä¿®å¤**: `sendToOpenClaw()` ç»Ÿä¸€å¸¦ `channel: "telegram"` + `to: "-5088310983"`ã€‚
**çŠ¶æ€**: âœ… å·²è§£å†³

---

## å·²è§£å†³çš„é—®é¢˜ï¼ˆ2026-02-11 æ‰¹æ¬¡ï¼‰

### P5: Webhook æ¶ˆæ¯è·¯ç”±åˆ°é”™è¯¯çš„ Agent

**ç°è±¡**: hermes-hook.js å‘é€ webhook åˆ° `/hooks/agent`ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ° `coder` agent è€Œä¸æ˜¯ `hermes` agentã€‚gateway.err.log ä¸­ `lane=session:agent:coder:hermes-notifications`ã€‚

**æ ¹å› **: `buildWebhookPayload` ä¸­ `agentId` å†™çš„æ˜¯ `'kiro'`ï¼Œä½† openclaw.json ä¸­ agent ID æ˜¯ `'hermes'`ï¼ˆä¸æ˜¯ `'kiro'`ï¼‰ã€‚OpenClaw æ ¹æ® `agentId` è·¯ç”± webhookï¼Œ`'kiro'` ä¸åŒ¹é…ä»»ä½• agentï¼Œfallback åˆ° coderã€‚

**ä¿®å¤**: `plugins/hermes-hook.js` ä¸­ `agentId: 'kiro'` â†’ `agentId: 'hermes'`ã€‚Property-Based Test (Property 4) éªŒè¯ agentId å§‹ç»ˆä¸º `'hermes'`ã€‚

**çŠ¶æ€**: âœ… å·²è§£å†³

### P6: ç”¨æˆ·å›å¤ RUN åæ— æ³•æ­£ç¡®è½¬å‘

**æ ¹å› **: P5 çš„ä¸‹æ¸¸é—®é¢˜ã€‚æ¶ˆæ¯è·¯ç”±åˆ° coder agent sessionï¼Œhermes agent ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ ğŸ”´ æ¶ˆæ¯ï¼Œæ— æ³•æå– sid/pidã€‚

**ä¿®å¤**: P5 ä¿®å¤åè‡ªåŠ¨è§£å†³ã€‚

**çŠ¶æ€**: âœ… å·²è§£å†³

### P7: Agent è‡ªä½œä¸»å¼ é£é™©

**ç°è±¡**: Agent æ”¶åˆ° ğŸ”´ æ¶ˆæ¯åå¯èƒ½è‡ªè¡Œé€‰æ‹© RUN è€Œéç­‰å¾…ç”¨æˆ·ã€‚

**ä¿®å¤**: SOUL.md å…¨é¢æ›´æ–°ï¼š
- Agent åªå‘é€äººç±»å¯è¯»æ‘˜è¦ï¼ˆå‘½ä»¤ã€é£é™©ã€é€‰é¡¹ï¼‰ï¼Œä¸å‘é€ curl å‘½ä»¤åŸæ–‡
- Agent ç­‰å¾…ç”¨æˆ·å›å¤ RUN/ALWAYS/REJECT åè‡ªå·±æ‰§è¡Œå¯¹åº” curl å‘½ä»¤
- æ–°å¢æ¶ˆæ¯è·¯ç”±è§„åˆ™ï¼šæ‹¬å·å†…å®¹ = è·Ÿ Agent è¯´è¯ï¼Œæ— æ‹¬å· = ç›´æ¥è½¬å‘ OpenCode
- HERMES_WEBHOOK é“å¾‹å¼ºåŒ–ï¼šæ˜ç¡®ç¦æ­¢æŠŠ curl å‘½ä»¤å‘ç»™ç”¨æˆ·

**çŠ¶æ€**: âœ… å·²è§£å†³

---

## æ¶ˆæ¯æµå®Œæ•´é“¾è·¯

```
OpenCode æ‰§è¡Œå‘½ä»¤
    â†“ è§¦å‘ permission.asked äº‹ä»¶
hermes-hook.js æ•è·äº‹ä»¶
    â†“ æå– sid, pid, command, risk
    â†“ æ„å»ºå«é¢„æ„å»º curl å‘½ä»¤çš„æ¶ˆæ¯
    â†“ POST /hooks/agent (OpenClaw Gateway :18789, agentId: "hermes")
OpenClaw Gateway æ¥æ”¶ webhook
    â†“ è·¯ç”±åˆ° hermes agent (âœ… agentId åŒ¹é…)
Hermes Agent å¤„ç†æ¶ˆæ¯
    â†“ å»æ‰ HERMES_WEBHOOK å‰ç¼€
    â†“ æå–äººç±»å¯è¯»æ‘˜è¦ï¼ˆå‘½ä»¤ã€é£é™©ã€é€‰é¡¹ï¼‰
    â†“ å‘é€åˆ° TG ç¾¤ç»„ -5088310983
ç”¨æˆ·åœ¨ TG ç¾¤ç»„çœ‹åˆ°æ‘˜è¦æ¶ˆæ¯
    â†“ å›å¤ RUN / ALWAYS / REJECT
Hermes Agent æ”¶åˆ°ç”¨æˆ·å›å¤
    â†“ ä»ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°å¯¹åº” curl å‘½ä»¤
    â†“ exec: curl POST /session/{sid}/permissions/{pid} (OpenCode :4096)
OpenCode æ”¶åˆ°å®¡æ‰¹
    â†“ ç»§ç»­æ‰§è¡Œ
Hermes Agent å‘ŠçŸ¥ç”¨æˆ·æ‰§è¡Œç»“æœ
```

---

## Permission Event æ•°æ®ç»“æ„

æ¥è‡ª `/tmp/hermes-perm-*.json`ï¼š

```json
{
  "type": "permission.asked",
  "properties": {
    "id": "per_c47d90dc80018peRggfCfQj6hi",
    "sessionID": "ses_3b8338d9dffe80imMNvaSYpHl3",
    "permission": "bash",
    "patterns": ["echo hello"],
    "metadata": {},
    "always": ["echo *"],
    "tool": {
      "messageID": "msg_c47d8fa52001nXIEGeUzvhuZ3A",
      "callID": "call_function_j4z7buxm38eo_1"
    }
  }
}
```

å­—æ®µè¯´æ˜:
- `id` â†’ pid (permission ID)ï¼Œç”¨äº `/session/{sid}/permissions/{pid}`
- `sessionID` â†’ sid (session ID)
- `permission` â†’ æƒé™ç±»å‹ (bash, file ç­‰)
- `patterns` â†’ è¦æ‰§è¡Œçš„å‘½ä»¤
- `always` â†’ å¦‚æœé€‰ ALWAYSï¼ŒåŒ¹é…çš„ glob æ¨¡å¼

---

## OpenClaw Webhook API è°ƒæŸ¥

### å·²çŸ¥ç«¯ç‚¹

| ç«¯ç‚¹ | æ¥æº | è¯´æ˜ |
|------|------|------|
| `POST /hooks/agent` | å½“å‰ä»£ç ä½¿ç”¨ | æ¥å— `message`, `name`, `sessionKey`, `wakeMode`, `channel`, `to` |
| `POST /hooks/wake` | å®˜æ–¹æ–‡æ¡£æåˆ° | æ¥å— `text`, `mode` ("now" / "next-heartbeat") |
| `POST /hooks/file-chooser` | æºç  routes.js | å†…éƒ¨ç”¨ |
| `POST /hooks/dialog` | æºç  routes.js | å†…éƒ¨ç”¨ |

### `/hooks/agent` å‚æ•°ï¼ˆå·²éªŒè¯å¯ç”¨ï¼‰

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `message` | string | æ¶ˆæ¯å†…å®¹ï¼ˆå« HERMES_WEBHOOK å‰ç¼€ï¼‰ |
| `name` | string | å‘é€è€…åç§° |
| `agentId` | string | âœ… æŒ‡å®šè·¯ç”±åˆ°å“ªä¸ª agentï¼ˆå¿…é¡»ä¸ openclaw.json agents.list[].id ä¸€è‡´ï¼‰ |
| `sessionKey` | string | session æ ‡è¯†ï¼ˆç›¸åŒ key å¤ç”¨ sessionï¼‰ |
| `wakeMode` | string | `"now"` ç«‹å³å”¤é†’ |
| `channel` | string | æŠ•é€’é€šé“ `"telegram"` |
| `to` | string | ç›®æ ‡ç¾¤ç»„ ID |

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **é‡å¯ OpenCode** ä½¿æ’ä»¶æ›´æ–°ç”Ÿæ•ˆï¼ˆ`agentId: "hermes"` + æ¶ˆæ¯æ ¼å¼æ›´æ–°ï¼‰
2. **ç«¯åˆ°ç«¯éªŒè¯**: è§¦å‘ permission.asked â†’ æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾ hermes agent ç¾¤ç»„ `-5088310983`
3. **æ£€æŸ¥ gateway.err.log** ç¡®è®¤ lane å˜ä¸º `session:agent:hermes:hermes-notifications`
4. **éªŒè¯å®Œæ•´é—­ç¯**: ç”¨æˆ·å›å¤ RUN â†’ Agent è‡ªå·±æ‰§è¡Œ curl â†’ OpenCode ç»§ç»­
5. **éªŒè¯æ‹¬å·è·¯ç”±**: å‘é€ `ï¼ˆçŠ¶æ€ï¼‰` ç¡®è®¤ Agent ä¸è½¬å‘ï¼Œå‘é€æ™®é€šæ¶ˆæ¯ç¡®è®¤è½¬å‘

---

## 2026-02-11 å˜æ›´æ‘˜è¦

| å˜æ›´ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| agentId ä¿®æ­£ | `plugins/hermes-hook.js` | `'kiro'` â†’ `'hermes'`ï¼ŒåŒ¹é… openclaw.json |
| PBT Property 4 | `plugins/hermes-hook.test.js` | éªŒè¯ agentId å§‹ç»ˆä¸º `'hermes'` |
| Agent æ‰§è¡Œ curl | `HERMES_openclaw/SOUL.md` | Agent è‡ªå·±æ‰§è¡Œ curlï¼Œä¸å‘ç»™ç”¨æˆ· |
| æ‹¬å·è·¯ç”±è§„åˆ™ | `HERMES_openclaw/SOUL.md` | `ï¼ˆæ‹¬å·ï¼‰` = è·Ÿ Agent è¯´è¯ï¼Œæ— æ‹¬å· = è½¬å‘ |
| HERMES_WEBHOOK é“å¾‹å¼ºåŒ– | `HERMES_openclaw/SOUL.md` | ç¦æ­¢æŠŠ curl å‘½ä»¤åŸæ–‡å‘ç»™ç”¨æˆ· |
| æ–‡æ¡£é‡å‘½å | `HERMES_openclaw/*.md` | Kiro â†’ Hermes å…¨å±€æ›¿æ¢ |

---

**æœ€åæ›´æ–°**: 2026-02-11
